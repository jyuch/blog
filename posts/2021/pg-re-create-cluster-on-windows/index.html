<!doctype html><html lang=ja><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>WindowsでもPostgreSQLのデータディレクトリを移動したい - レンコン畑でつかまえて</title><meta content=Windowsにおいてインストール後のPostgreSQLのデータディレクトリに移動方法を解説しています name=description><link href=/pagefind/pagefind-ui.css rel=stylesheet><link href=/styles.css rel=stylesheet><link href=/feed.xml rel=alternate title=レンコン畑でつかまえて type=application/atom+xml><link href=/feed.json rel=alternate title=レンコン畑でつかまえて type=application/json><script src=/pagefind/pagefind-ui.js></script><script>window.addEventListener('DOMContentLoaded',()=>{new PagefindUI({"element":"#search","showImages":false,"excerptLength":0,"showEmptyFilters":true,"showSubResults":false,"resetStyles":false,"bundlePath":"/pagefind/","baseUrl":"/"});});</script><body><nav class=navbar><a class=navbar-home href=/> <strong>レンコン畑でつかまえて</strong> </a><ul class=navbar-links><li><a href=/> Home </a><li><a href=/posts/> Archive </a><li><a href=https://about.jyuch.dev/> About Me </a></ul><div class=navbar-search><div id=search></div></div></nav><main class=body-post><article class=post data-pagefind-body><div class=post-header><h1 class=post-title>WindowsでもPostgreSQLのデータディレクトリを移動したい</h1><nav class=post-tags><a class=tag href=/tags/postgres/>postgres</a></nav><time datetime="2021-11-08 00:00:00" class=post-date> November 8th, 2021 </time></div><div class=post-body><h2>はじめに</h2><p>何らかの理由により、インストール済みのクラスタを再作成したい時のお話です。<p>11で検証しましたが、まぁ他のバージョンでも同じだと思います。<h2>サービスマネージャからPostgresサービスを停止する</h2><p>停止します。<h2>新しい場所にデータベースクラスタを再作成する</h2><p>管理者で実行しているコマンドプロンプトから以下のコマンドを実行します。<pre><code class="language-bat hljs language-dos">> "C:\Program Files\PostgreSQL\<span class=hljs-number>11</span>\bin\initdb.exe" -D "C:\pgdata\<span class=hljs-number>11</span>" -U postgres --encoding=UTF8 --locale=C

データベースシステム内のファイルの所有者は"JYUCH"となります。
このユーザがサーバプロセスも所有する必要があります。

データベースクラスタはロケール"C"で初期化されます。
デフォルトのテキスト検索設定はenglishに設定されました。

データベージのチェックサムは無効です。

ディレクトリC:/pgdata/<span class=hljs-number>11</span>を作成します ... 完了
サブディレクトリを作成します ... 完了
max_connectionsのデフォルト値を選択します ... <span class=hljs-number>100</span>
shared_buffersのデフォルト値を選択します ... <span class=hljs-number>128</span>MB
selecting default timezone ... Asia/Tokyo
動的共有メモリの実装を選択します ... windows
設定ファイルを作成します ... 完了
ブートストラップスクリプトを実行します ... 完了
ブートストラップ後の初期化を行っています ... 完了
データをディスクに同期します...完了

警告: ローカル接続で"trust"認証を有効にします。
この設定はpg_hba.confを編集するか、次回のinitdbの実行の際であれば-Aオプ
ション、または、--auth-localおよび--auth-hostを使用することで変更するこ
とができます。

成功しました。以下のようにしてデータベースサーバを起動できます。

    ^"C^:^\Program^ Files^\PostgreSQL^\<span class=hljs-number>11</span>^\bin^\pg^_ctl^" -D ^"C^:^\pgdata^\<span class=hljs-number>11</span>^" -l &lt;ログファイル> <span class=hljs-built_in>start</span>
</code></pre><h2>以前に登録済みのサービスの登録を消す</h2><p>管理者で実行しているコマンドプロンプトから以下のコマンドを実行します。<pre><code class="language-bat hljs language-dos">"C:\Program Files\PostgreSQL\<span class=hljs-number>11</span>\bin\pg_ctl.exe" unregister -N postgresql-x64-<span class=hljs-number>11</span>
</code></pre><h2>一度Windowsを再起動する</h2><p>します。<h2>サービスを再登録する</h2><p>管理者で実行しているコマンドプロンプトから以下のコマンドを実行します。<pre><code class="language-bat hljs language-dos">"C:\Program Files\PostgreSQL\<span class=hljs-number>11</span>\bin\pg_ctl.exe" register -N postgresql-x64-<span class=hljs-number>11</span> -U "NT AUTHORITY\NetworkService" -D "C:\pgdata\<span class=hljs-number>11</span>" -w
</code></pre><h2>サービスを起動する</h2><p>祈りながらサービスコンソールから先ほど登録したサービスを起動します<h2>確認</h2><p>psqlコマンドから試しに接続してみて、問題無いか確認します。<h2>参考</h2><ul><li>https://lets.postgresql.jp/documents/tutorial/windows/1#pgdata</ul><p>おわり</div></article><hr><nav class=post-navigation><ul><li>← Previous: <a href=/posts/2021/pg-streaming-replication/ rel=prev>PostgreSQLでもストリーミングレプリケーションを試してみたい</a><li><strong>Next: <a href=/posts/2021/pgpool-ha/ rel=next>Pgpool-IIを使用した高可用性構成を試してみたい</a> →</strong></ul></nav></main><footer><div><a href=/feed.xml> <svg viewbox="0 0 16 16" height=16 width=16 xmlns=http://www.w3.org/2000/svg><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"></path><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"></path></svg> </a></div></footer>