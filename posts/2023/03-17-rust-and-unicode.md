---
title: Rustã§ã‚‚æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ãŸã„
description: Rustã§ã‚‚æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ãŸã„
date: 2023-03-17
lastModified: 2023-03-17
tags: 
  - rust
  - character encoding
---

# ã¯ã˜ã‚ã«

å¾Œè¼©ã«Unicodeã‚’ç†±ãèªã£ãŸã‚‰å¼•ã‹ã‚Œã¾ã—ãŸã€‚ã©ã†ã‚‚å¼Šç¤¾ã§ã™

ä»Šã¾ã§çµæ§‹Rustã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ã¾ã—ãŸãŒã€ãã†ã„ãˆã°æ—¥æœ¬èªå‘¨ã‚Šã®æŒ™å‹•ã‚’ç¢ºèªã—ã¦ã„ãªã‹ã£ãŸãªã¨ã„ã†ã“ã¨ã§ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

# å‰æçŸ¥è­˜

ã“ã®è¾ºã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§å‰²ã¨å‘¨çŸ¥ãªå†…å®¹ãªã‚“ã˜ã‚ƒãªã„ã‹ãªã¨ã„ã†æ‰€ã§ã™ãŒã€Rustã¯å†…éƒ¨çš„ã«ã¯æ–‡å­—åˆ—ã¯UTF-8ã§æ‰±ã£ã¦ã„ã¾ã™ã€‚

èƒŒæ™¯ã¯èª¿ã¹ã¦ãªã„ã®ã§çŸ¥ã‚Šã¾ã›ã‚“ã€‚
å¤šåˆ†JSONã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã¨ã‹ã§å¤‰æ›ã‚³ã‚¹ãƒˆãŒæ¸›ã‚‹ã¨ã‹ã€ãƒ¡ãƒ¢ãƒªæ¶ˆè²»é‡ã‚’æ¸›ã‚‰ã—ãŸã„ã¨ã‹ãªã‚“ã¨ã‹ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ã€‚

# æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ

`String`ã«ã¯`pub fn len(&self) -> usize`ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒç”Ÿãˆã¦ã„ã¾ã™ãŒã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã—ã¦ãã¾ã™ã€‚
Rustã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯æ–‡å­—ã¯UTF-8ã§ã‚ã‚‹ã“ã¨ã‚’ã—ã¤ã“ã„ãã‚‰ã„æ›¸ã„ã¦ã„ã‚‹ã®ã§ã€ç´å¾—ã§ãã‚‹æŒ™å‹•ã§ã¯ã‚ã‚Šã¾ã™ã€‚

ãŒã€æˆ‘ã€…æ—¥æœ¬äººã¯æ¼¢å­—ã‚’ä½¿ã‚ãªã„ã¨ã„ã‘ãªã„ç‚ºã€ãã‚Œã§ã¯å›°ã‚‹ã‚ã‘ã§ã™ã€‚

ãã“ã§ã€`pub fn chars(&self) -> Chars<'_>`ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦`char`ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãã®æ•°ã‚’æ•°ãˆã‚Œã°æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆå‡ºæ¥ã¾ã™ã€‚

```rust
let a = String::from("Hello World");
let b = String::from("ã“ã‚“ã«ã¡ã¯");

println!("{} {} {}", a, a.len(), a.chars().count());
println!("{} {} {}", b, b.len(), b.chars().count());
```

```shell
Hello World 11 11
ã“ã‚“ã«ã¡ã¯ 15 5
```

# æœ¬å½“ã«ãã‚Œã§ã„ã„ã®ï¼Ÿ

ã“ã“ã¾ã§ã®èª¬æ˜ã§ã€ã€Œ`a.chars().count()`ã‚’å‘¼ã³å‡ºã›ã°ã„ã„ã®ã­ï¼ã€ã¨ç´å¾—ã—ã¦å¸°ã‚‹äººã¯æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®æ€–ã•ã‚’çŸ¥ã‚‰ãªã„äººã§ã™ã€‚
JIS X 0208è¦æ ¼ç¥¨ã§ç´ æŒ¯ã‚Šã‚’1000å›ã‚„ã£ã¦ã‹ã‚‰å‡ºç›´ã—ã¦ãã¦ãã ã•ã„ã€‚

ä¸Šã®æ–‡ã‚’ã‚‚ã†ä¸€åº¦èª­ã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

> `pub fn chars(&self) -> Chars<'_>`ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦`char`ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€

ãã†ã§ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯`char`ã€ã™ãªã‚ã¡ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«éããªã„ã‚ã‘ã§ã™ã€‚

ãŸã¨ãˆã°ã€ã€Œã¯ï¼ˆU+306Fï¼‰ã€+ã€Œã‚œï¼ˆU+309Aï¼‰ã€ã§è¡¨ç¾ã•ã‚Œã‚‹ã€Œã¯ã‚šã€ã¯å®¹èµ¦ãªã2æ–‡å­—ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã‚ã‘ã§ã™ã€‚

```rust
let a = vec!['ã¯', '\u{309A}'];
let a: String = a.iter().collect();
println!("{} {} {}", a, a.len(), a.chars().count());
```

```shell
ã¯ã‚š 6 2
```

ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ç›¸æ‰‹ãªã‚‰ã€Œå†…éƒ¨çš„ã«ã¯2æ–‡å­—ãªã‚“ã§ã™ã‚ˆï½ã€ã¨è¨€ãˆã°ã„ã„ã ã‘ï¼Ÿã§ã™ãŒã€ä¸€èˆ¬äººã«ãã‚“ãªã“ã¨ã‚’è¨€ã£ã¦ã‚‚ã€Œä½•è¨€ã£ã¦ã‚“ã ã“ã„ã¤ã€ã¨ãªã‚‹ã ã‘ã§ã™ã€‚

# Unicodeæ­£è¦åŒ–

ã—ã‹ã—ã€æˆ‘ã€…ã«ã¯ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè¨˜å·ãªã©ã‚’åˆ†è§£å¾Œå†çµåˆã§ãã‚‹Unicodeæ­£è¦åŒ–ã¨ã„ã†æ³•å…·ãŒå­˜åœ¨ã—ã¾ã™ã€‚

ãŒã€Rustã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å…¥ã£ã¦ã¾ã›ã‚“ã€‚
[unicode-normalization](https://github.com/unicode-rs/unicode-normalization)ã‚’ä½¿ã†ã—ã‹ãªã•ãã†ã§ã™ã€‚

```toml
[dependencies]
unicode-normalization = "0.1"
```

```rust
fn test(value: &Vec<char>) {
    let str: String = value.iter().collect();
    println!("{} {} {}", str, str.len(), str.chars().count());

    let str = str.nfc().to_string();
    println!("{} {} {}", str, str.len(), str.chars().count());
}
```

```rust
let a = vec!['ã¯', '\u{309A}'];
test(&a);
```

```shell
ã¯ã‚š 6 2
ã± 3 1
```

ãªã—ã¨ã’ã¾ã—ãŸ

ã—ã‹ã—ã€çµåˆå¾Œã®æ–‡å­—ãŒåéŒ²ã•ã‚Œã¦ã„ãªã„æ–‡å­—ã¯ã‚„ã¯ã‚Šã ã‚ã§ã™ã€‚

```rust
let a = vec!['ã‹', '\u{309A}'];
test(&a);
```

```shell
ã‹ã‚š 6 2
ã‹ã‚š 6 2
```

# Unicodeãƒ†ã‚­ã‚¹ãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

ãã“ã§ã€UnicodeÂ® Standard Annex #29 UNICODE TEXT SEGMENTATIONã®å‡ºç•ªã§ã™ã€‚

ã“ã„ã¤ã§Grapheme Cluster Boundariesï¼ˆæ›¸è¨˜ç´ ï¼‰å˜ä½ã§ã¶ã£ãŸåˆ‡ã£ã¦ã‚„ã‚Œã°ã„ã„ã®ã§ã™ã€‚

åŒã˜unicode-rsã‚°ãƒ«ãƒ¼ãƒ—ãŒé–‹ç™ºã—ã¦ã„ã‚‹[unicode-segmentation](https://github.com/unicode-rs/unicode-segmentation)ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```toml
[dependencies]
unicode-segmentation = "1"
```

```rust
fn test(value: &Vec<char>) {
    let str: String = value.iter().collect();
    println!("{} {} {}", str, str.len(), str.chars().count());

    let str = str.nfc().to_string();
    println!("{} {} {}", str, str.len(), str.chars().count());

    let g = str.graphemes(true).collect::<Vec<&str>>();
    println!("{} {} {}", str, str.len(), g.len());
}
```

```rust
let a = vec!['ã‹', '\u{309A}'];
test(&a);
```

```shell
ã‹ã‚š 6 2
ã‹ã‚š 6 2
ã‹ã‚š 6 1
```

ãªã—ã¨ã’ã¾ã—ãŸ

ã“ã‚Œãªã‚‰ã¿ã‚“ãªå¤§å¥½ãIVSã‚‚æ­£ã—ãã‚«ã‚¦ãƒ³ãƒˆã§ãã¾ã™ã€‚

```rust
let a = vec!['\u{8FBB}', '\u{E0100}'];
test(&a);
```

```shell
è¾»ó „€ 7 2
è¾»ó „€ 7 2
è¾»ó „€ 7 1
```

```rust
let a = vec!['\u{1F385}', '\u{1F3FF}'];
test(&a);
```

```shell
ğŸ…ğŸ¿ 8 2
ğŸ…ğŸ¿ 8 2
ğŸ…ğŸ¿ 8 1
```

ãŠã‚ã‚Š
